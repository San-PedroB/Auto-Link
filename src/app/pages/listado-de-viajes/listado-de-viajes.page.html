<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="esConductor ? '/home-conductor' : '/home-pasajero'" text="Volver"></ion-back-button>
    </ion-buttons>
    <ion-title>Listado de Viajes</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-grid>
    <!-- Sección para Mi Viaje -->
    <ion-row *ngIf="viajesPendientes.length > 0 || viajesAceptados.length > 0">
      <ion-col size="12">
        <h2 class="ion-text-center">Mi Viaje</h2>
        <ng-container *ngFor="let viaje of viajesPendientes.concat(viajesAceptados)">
          <ion-card *ngIf="viaje.conductorCorreo === usuarioActualCorreo">
            <ion-card-header>
              <ion-card-title>{{ viaje.origen }} → {{ viaje.destino }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p><strong>Origen:</strong> {{ viaje.origen }}</p>
              <p><strong>Destino:</strong> {{ viaje.destino }}</p>
              <p><strong>Precio:</strong> ${{ viaje.precio }}</p>
              <p>
                <strong>Estado:</strong>
                <ion-badge [color]="viaje.estado === 'pendiente' ? 'warning' : 'success'">
                  {{ viaje.estado | titlecase }}
                </ion-badge>
              </p>

              <!-- Botón "Cancelar Viaje" si el viaje está pendiente -->
              <ion-button 
                *ngIf="viaje.estado === 'pendiente'" 
                expand="full" 
                color="danger" 
                (click)="cancelarViaje(viaje.id)">
                Cancelar Viaje
              </ion-button>

              <!-- Botón "Terminar Viaje" si el viaje está aceptado -->
              <ion-button 
                *ngIf="viaje.estado === 'aceptado'" 
                expand="full" 
                color="warning" 
                (click)="terminarViaje(viaje.id)">
                Terminar Viaje
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ng-container>
      </ion-col>
    </ion-row>

    <!-- Sección para Otros Viajes -->
    <ion-row *ngIf="viajesPendientes.length > 0">
      <ion-col size="12">
        <h2 class="ion-text-center">Otros Viajes</h2>
        <ng-container *ngFor="let viaje of viajesPendientes">
          <ion-card>
            <ion-card-header>
              <ion-card-title>{{ viaje.origen }} → {{ viaje.destino }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p><strong>Origen:</strong> {{ viaje.origen }}</p>
              <p><strong>Destino:</strong> {{ viaje.destino }}</p>
              <p><strong>Precio:</strong> ${{ viaje.precio }}</p>
              <p><strong>Pasajeros:</strong> {{ viaje.cantidadPasajeros }}</p>
              <p><strong>Conductor:</strong> {{ viaje.conductorNombre }} {{ viaje.conductorApellido }}</p>
              <p>
                <strong>Estado:</strong>
                <ion-badge [color]="viaje.estado === 'pendiente' ? 'warning' : 'success'">
                  {{ viaje.estado | titlecase }}
                </ion-badge>
              </p>


              <!-- Botón "Cancelar Viaje" solo visible si el viaje está pendiente y el usuario es el conductor -->
              <ion-button 
                *ngIf="esConductor && viaje.estado === 'pendiente' && viaje.conductorCorreo === usuarioActualCorreo" 
                expand="full" 
                color="danger" 
                (click)="cancelarViaje(viaje.id)">
                Cancelar Viaje
              </ion-button>

              <!-- Botón "Tomar Viaje" solo visible para pasajeros -->
              <ion-button *ngIf="esPasajero" expand="full" color="success" (click)="tomarViaje(viaje)">
                Tomar Viaje
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ng-container>
      </ion-col>
    </ion-row>

    <!-- Mensaje cuando no hay viajes disponibles -->
    <ion-row *ngIf="viajesPendientes.length === 0 && (!esConductor || viajesAceptados.length === 0)">
      <ion-col>
        <p class="ion-text-center">No hay viajes disponibles en este momento.</p>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-title class="ion-text-center">Auto Link</ion-title>
  </ion-toolbar>
</ion-footer>
